
                    Файловый и архивный менеджер FAR
                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                               Макросы
                               ~~~~~~~

   В этом документе описаны дополнительные технические подробности по
макросам, не включенные в основную помощь.

   Все макрокоманды хранятся в ветке реестра
[HKEY_CURRENT_USER\Software\Far\KeyMacros]

   Макрокоманды делятся на 13 областей:

   Область       Назначение
   --------------------------------------------------
   "Shell"       Файловые панели
   "Viewer"      Внутренняя программа просмотра
   "Editor"      Редактор
   "Dialog"      Диалоги
   "Search"      Быстрый поиск в панелях
   "Disks"       Меню выбора дисков
   "MainMenu"    Основное меню
   "Menu"        Прочие меню
   "Help"        Система помощи
   "Info"        Информационная панель
   "QView"       Панель быстрого просмотра
   "Tree"        Панель дерева папок
   "Other"       Режим копирования текста с экрана, вертикальные меню
   --------------------------------------------------

   На каждую макрокоманду в реестре заводится отдельная ветвь с именем
назначенной клавиши. Макрокоманда описывается определенным набором
значений:

   Параметр              Тип       По          Назначение
                                умолчанию
   -----------------------------------------------------------------------
   "Sequence"            REG_SZ          Последовательность клавиш
   "DisableOutput"       REG_DWORD  1    Запретить на время выполнения
                                         вывод на экран
   "RunAfterFARStart"    REG_DWORD  0    Выполнять после запуска FAR
   "EmptyCommandLine"    REG_DWORD  0    Выполнять, только если командная
                                         строка пуста
   "NotEmptyCommandLine" REG_DWORD  0    Выполнять, только если командная
                                         строка не пуста
   "NoFilePanels"        REG_DWORD  0    Не выполнять для файловой панели
   "NoPluginPanels"      REG_DWORD  0    Не выполнять для плагиновой панели
   "NoFolders"           REG_DWORD  0    Не выполнять если текущий элемент -
                                         папка
   "NoFiles"             REG_DWORD  0    Не выполнять если текущий элемент -
                                         файл
   "Selection"           REG_DWORD  0    Выполнять, только если на панели
                                         есть отмеченные файлы/папки или
                                         выделен блок в редакторе
   "NoSelection"         REG_DWORD  0    Выполнять, если нет отмеченных
                                         файлов/папок или блока в редакторе
   "Description"         REG_SZ          Комментарий (не используется)
   -----------------------------------------------------------------------
   Обязательным является параметр "Sequence", остальные могут отсутствовать
и принимать значение по умолчанию.

   Последовательность "Sequence" содержит строковое представление
макрокоманды. Каждая клавиша имеет свой строковый эквивалент, разделителем
клавиш является пробел или табуляция.

   FAR поддерживает некоторые специальные псевдоклавиши, которые невозможно
использовать во время задания макроса стандартным образом, добавить их в
макрос можно только путем ручной правки реестра или путем применения
специальных программ/плагинов.


   $Date ["format"]
       Текущее время используется для преобразования в строку по
       формату "format". Если аргумент "format" не указан, то FAR
       будет использовать форматную строку "%a %b %d %H:%M:%S %Z %Y".
       Этот формат подобен тому, что выдает утилита date (Unix).
       $Date поддерживает следующую спецификацию формата даты (подобен
       формату функции strftime):

        %%   символ %
        %a   Краткое имя дня недели (Sun или Вск)
        %A   Полное имя дня недели (Sunday или Воскресенье)
        %b   Краткое имя месяца (Jan или Янв)
        %B   Полное имя месяца (January или Январь)
        %c   Дата и время в формате WDay Mnt Day HH:MM:SS yyyy
             (Mon Jan 10 04:11:54 2000 или Пнд Янв 10 04:11:54 2000)
        %C   Столетие как десятичное число (00 - 99). 1992 => 19
        %d   Две цифры дня месяца (01 - 31)
        %D   Синоним для %x
        %e   Синоним для %d, но вместо ведущего нуля будет стоять пробел.
        %h   Синоним для %b
        %H   Две цифры часа (00 - 23)
        %I   Две цифры часа (01 - 12)
        %j   Три цифры дня в году (001 - 366)
        %k   Синоним для %H, но вместо ведущего нуля будет стоять пробел.
        %l   Синоним для %I, но вместо ведущего нуля будет стоять пробел.
        %L   Триггер, переключающий язык названий месяцев и дней недели
             - английский/локальный.
             FAR запрашивает у системы 2 набора наименований:
             1) английские наименования месяцев и дней недели
             2) наименования, соответствующие настройкам текущего
                пользователя (LOCALE_USER_DEFAULT)
             По умолчанию выставляются английские наименования.
        %m   Месяц, как десятичное число (1 - 12)
        %m0  Подобно %m, но с ведущим нулем (01 - 12)
        %mh  Одна цифра месяца, как шестнадцатеричное число (1 - С)
        %M   Две цифры минут (00 - 59)
        %n   Подобно переводу строки `\n'
             Внимание! В редакторе автоотступ не работает.
        %p   AM или PM
        %r   Подобно %I:%M:%S %p
        %R   Подобно %H:%M
        %S   Две цифры секунд (00 - 59)
        %t   Подобно символу табуляции `\t'
        %T   Синоним %X
        %U   Две цифры номера недели, где Воскресенье (Sunday) является
             первым днем недели (00 - 53)
        %v   Дата в формате dd-mmm-yyyy (mmm - в верхнем регистре)
        %V   Неделя года в соответствии с ISO 8601:
             "Если неделя, содержащая 1 Января, имеет >= 4 дней в течение
             нового года, тогда это неделя 1; в противном случае это самая
             последняя нумерованная неделя прошлого года (52 или 53)"
        %w   День недели где 0 - Воскресенье (Sunday) (0 - 6)
        %W   Две цифры номера недели, где Понедельник (Monday) является
             первым днем недели (00 - 53)
        %x   Дата в формате подобно dd<sep>mm<sep>yyyy (разделитель <sep>
             зависит от локальных настроек; порядок дня, месяца и года зависит
             от локальных настроек)
        %X   Время в формате HH<sep>MM<sep>SS (разделитель <sep> зависит от
             локальных настроек)
        %y   Две цифры года без столетия (00 - 99)
        %Y   Год со столетием (19yy-20yy)
        %Z   Имя часового пояса или пусто, если часовой пояс не задан

       Произвольный текст в форматной строке должен быть только в
       OEM-кодировке.

   $MMode 1
       Сменить режим макроса. Изменяет режим отображения ("DisableOutput").
       Работает как триггер.

   $XLat
       Вызывает функцию транслитерации. Работает независимо от того, какие
       клавиши назначили в TechInfo#10.


Замечания
~~~~~~~~~
   а) FAR не считывает макросы имеющие ошибки в названии макроклавиши и
   в последовательности "Sequence".

   б) Регистр макрокоманд не имеет значения.

   в) Интерактивно нельзя назначить для макроса клавишу ESC.
   Это можно сделать любым другим удобным для вас способом. См. пример
   макроса на Esc: Addons\Macros\Esc.reg

   г) При старте FAR Manager загружает весь комплект описанных в реестре
   макрокоманд в память. После создания любая макропоследовательность
   немедленно заносится в реестр (при включенном автосохранении).

   д) Флаги "NoFilePanels" и "NoPluginPanels" имеют приоритет выше, чем
   флаги "NoFolders" и "NoFiles".

   е) Флаги "Selection" и "NoSelection" имеют приоритет ниже, чем флаги
   "NoFolders" и "NoFiles".

   ж) Макроклавиша, название которой в реестре начинается с символа '~',
   считается неактивной.

   з) FAR Manager преобразует прокрутку колеса мыши в псевдоклавиши:
      - прокрутка на одно значение вверх - "MsWheelUp"
      - прокрутка на одно значение вниз - "MsWheelDown"
   Эти псевдоклавиши можно применять в сочетании с модификаторами Ctrl,
   Shift и Alt.

   и) Для манипулированием макрокомандами рекомендуем воспользоваться
   плагином "Macro browser" Константина Мельникова. Этот модуль
   обеспечивает просмотр, редактирование, копирование и перемещение
   макрокоманд в другие группы (области), копирование и перемещение
   макрокоманд в другие настройки FAR, экспорт в файл, вставку в редактор,
   ввод новых, удаление и отключение установленных в FAR макрокоманд.


                                     [ FAR manager development group ]
